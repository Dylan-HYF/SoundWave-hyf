<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <title>SoundWave-hyf</title>

  <!-- zimjs.com - JavaScript Canvas Framework -->
  <script src="https://zimjs.org/cdn/nft/00/zim.js"></script>


  <script>
    const path = 'assets/'
    const assets = ["backing.mp3", 'TheRealFolkBlues.mp3'];
    createjs.Sound.registerPlugins([createjs.HTMLAudioPlugin]);
    // See Docs under Frame for FIT, FILL, FULL, and TAG scaling modes
    const frame = new Frame(FIT, 1024, 768, darker, dark, assets, path);
    frame.on("ready", () => {
      const stage = frame.stage;
      let stageW = frame.width;
      let stageH = frame.height;
      // put your code here

      let button = new Button({
        label: "PLAY",
        backgroundColor: blue,
        rollBackgroundColor: pink,
        corner: 0
      }).center();
      button.on('click', () => {
        button.removeFrom()
        let soundWave = new SoundWave(50, asset("TheRealFolkBlues.mp3").play({ loop: true }))
        // asset("b01.mp3").play()
        soundWave.on("ready", function () {

          // create a container for the bars so we can add them and then center the container on the stage
          let bars = new Container();
          let width = stageW * .9; // leave a little around the sides...
          let gap = 3;

          // we can use soundWave.num to tell us how many bars to make
          loop(soundWave.num, function (i, total) {
            // make each bar
            let bar = new Rectangle(width / total - gap, 300, pink);
            // move the bar over a little each time and set the registration point to the bottom
            bar.addTo(bars).reg(bar.width / 2, 300).rot(i * 10)
          })
          bars.center();

          // animate the bars in a Ticker
          Ticker.add(function () {
            // call the calculate() method of the soundWave
            let data = soundWave.calculate();
            // loop throught the bars and set the height of the bar to the associated soundWave data
            // we multiply by 2 to magnify the data a little
            loop(bars, function (bar, i) {
              bar.heightOnly = data[i] / 2;
            });
          }); // end ticker




        }); // end soundWave ready
        stage.update()
      })

      stage.update(); // needed to view changes
    });

  </script>
  <meta name="viewport" content="width=device-width, user-scalable=no" />
</head>

<body></body>

</html>